<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>VOCATINEST</title>
    <link href="style.css" rel="stylesheet" />
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link rel="shortcut icon" href="img/logo-icon.svg">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link href="style-responsive.css" rel="stylesheet" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
</head>

<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light nav1">
        <div class="container">
            <a class="navbar-brand" href="index.html"><img src="img/logo-navbar.svg" class="img-fluid" alt="Responsive image"></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">
                <ul class="navbar-nav">
                    <li class="nav-item active">
                        <a class="nav-link" href="#">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Kenali Dirimu</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="cari-kerja.html">Cari Pekerjaan</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="cari-pelatihan.html">Cari Pelatihan</a>
                    </li>
                    <li class="nav-item cart">
                        <a class="nav-link" href=""><img src="img/nav-shop-cart.svg" alt=""></a>
                    </li>
                </ul>
                <form class="form-inline my-2 my-lg-0">
                    <img class="img-fluid" src="img/nav-img-profile.svg" alt="" id="nav-image">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="nav-name" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                ...
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                <a class="dropdown-item" onclick="logout()">Logout</a>
                            </div>
                        </li>
                    </ul>
                </form>
            </div>
        </div>
    </nav>
    <!-- Navbar -->

    <!-- Main -->
    <div class="container-fluid row-putih pt-0">
        <div class="container dashboard">
            <div class="col-12 text-center">
                <p class="besar">Dashboard Anda</p>
                <p class="abu">Temukan Beragam Pilihan Pekerjaan Vokasi Sesuai Dengan Bakat dan Minatmu</p>
            </div>
            <div class="col-12 top">
                <div class="row mt-4 justify-content-center">
                    <a href="dashboard-profile.html" class="col-3 btn p-4 mr-4 text-left active">
                        <div class="row">
                            <div class="col-12 col-sm-4 col-lg-3 my-auto">
                                <img src="img/dashboard-biru-1-active.svg" alt="">
                            </div>
                            <div class="col-12 col-sm-8 col-lg-9 my-auto">
                                <p class="besar">PROFIL ANDA</p>
                                <p class="kecil"><b>30%</b> Lengkap</p>
                            </div>
                        </div>
                    </a>

                    <a href="dashboard-pekerjaan.html" class="col-3 btn p-4 text-left">
                        <div class="row">
                            <div class="col-12 col-sm-4 col-lg-3 my-auto">
                                <img src="img/dashboard-biru-2.svg" alt="">
                            </div>
                            <div class="col-12 col-sm-8 col-lg-9 my-auto">
                                <p class="besar">PEKERJAAN ANDA</p>
                                <p class="kecil"><b>4</b> pekerjaan yang sesuai</p>
                            </div>
                        </div>
                    </a>

                    <a href="dashboard-pelatihan.html" class="col-3 btn p-4 ml-4 text-left">
                        <div class="row">
                            <div class="col-12 col-sm-4 col-lg-3 my-auto">
                                <img src="img/dashboard-biru-3.svg" alt="">
                            </div>
                            <div class="col-12 col-sm-8 col-lg-9 my-auto">
                                <p class="besar">PELATIHAN ANDA</p>
                                <p class="kecil"><b>2</b> pelatihan yang diikuti</p>
                            </div>
                        </div>
                    </a>
                </div>
            </div>

            <div class="col-12 mt-4 isi">
                <div class="row">
                    <div class="col-12 col-sm-4 kiri">
                        <div class="row p-2">
                            <div class="col-12 col-sm-12 text-center p-0 mb-5">
                                <div class="img-frame">
                                    <img src="" alt="no image" id="image">
                                </div>
                            </div>

                            <div class="col-6 col-sm-12 p-0 mb-5">
                                <p class="besar">Riwayat Pendidikan</p>
                                <div id="side_education"></div>
                            </div>

                            <div class="col-6 col-sm-12 p-0 mb-5">
                                <p class="besar">Lokasi</p>
                                <div id="side_address"></div>
                            </div>

                            <div class="col-6 col-sm-12 p-0 mb-5">
                                <p class="besar">Pengalaman Organisasi</p>
                                <div id="side_organization"></div>
                            </div>

                            <div class="col-6 col-sm-12 p-0">
                                <p class="besar">Penghargaan & Pencapaian</p>
                                <div id="award"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-sm-8 kanan">
                        <div class="col-12 p-0 mb-5">
                            <div class="row">
                                <div class="col-9 my-auto">
                                    <p class="nama mb-0"><b id="name">...</b></p>
                                </div>
                                <div class="col-3 text-right my-auto">
                                    <!-- <a href="edit-profile1.html" class="btn btnghost">Edit Profil</a> -->
                                </div>
                            </div>
                            <p class="mt-3" id="description">[Profil masih kosong]</p>
                        </div>

                        <div class="col-12 p-0 mb-5">
                            <p class="besar">Pekerjaan Terkait</p>
                            <ul class="nav my-auto detailpelatihan-isi" id="related-jobs">
                            </ul>
                        </div>

                        <div class="col-12 p-0 mb-5">
                            <div class="row mb-3">
                                <div class="col-8 my-auto">
                                    <p class="besar">Rekomendasi Pekerjaan Untuk Anda</p>
                                </div>
                                <div class="col-4 text-right my-auto">
                                    <a href="cari-kerja.html" class="btn btnghost">Telusuri Pekerjaan Lain</a>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-4">
                                    <div class="card">
                                        <img src="img/header-card1.svg" class="card-img-top" alt="...">
                                        <div class="card-body pb-0">
                                            <p class="besar">Programmer</p>
                                            <p class="mb-3">PT Inet Global Indo</p>
                                        </div>
                                        <div class="card-footer pt-0">
                                            <p class="mb-0">DKI Jakarta</p>
                                        </div>
                                        <div class="card-footer pt-0">
                                            <a class="btn btn-block mt-3">Daftar Sekarang</a>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-4">
                                    <div class="card">
                                        <img src="img/header-card2.svg" class="card-img-top" alt="...">
                                        <div class="card-body pb-0">
                                            <p class="besar">Technical Support</p>
                                            <p class="mb-3">Varnion Teknologi Semesta</p>
                                        </div>
                                        <div class="card-footer pt-0">
                                            <p class="mb-0">Bali</p>
                                        </div>
                                        <div class="card-footer pt-0">
                                            <a class="btn btn-block mt-3">Daftar Sekarang</a>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-4">
                                    <div class="card">
                                        <img src="img/header-card3.svg" class="card-img-top" alt="...">
                                        <div class="card-body pb-0">
                                            <p class="besar">System Developer</p>
                                            <p class="mb-3">Lattice Teknologi Mandiri</p>
                                        </div>
                                        <div class="card-footer pt-0">
                                            <p class="mb-0">Jawa Barat</p>
                                        </div>
                                        <div class="card-footer pt-0">
                                            <a class="btn btn-block mt-3">Daftar Sekarang</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-12 p-0 mb-5 last">
                            <p class="besar mb-3">Pengalaman Kerja</p>
                            <div id="job-experience"></div>
                        </div>

                        <div class="col-12 p-0 last">
                            <p class="besar mb-3">Riwayat Pendidikan</p>
                            <div id="education"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Main -->

    <!-- Footer -->
    <footer class="py-3">
        <div class="container">
            <div class="row">
                <div class="col-md-3">
                    <a href="index.html"><img src="img/logo-footer.svg" alt="">
                        <p>Copyrights © Vocatinest Team 2020</p>
                    </a>
                </div>
                <div class="col-md-9">
                    <ul class="nav justify-content-end">
                        <li class="nav-item">
                            <a class="nav-link" href="#">Tentang Kami</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Kenali Dirimu</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="cari-kerja.html">Cari Pekerjaan</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="cari-pelatihan.html">Cari Pelatihan</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Bantuan</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Kontak Kami</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Ketentuan & Kondisi</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>
    <!-- Footer -->
    <script>
        let personas = ['Komunikatif', 'Percaya Diri', 'Kreatif', 'Konsisten', 'Tepat Waktu'];
        function shuffle(array) {
            var currentIndex = array.length, temporaryValue, randomIndex;

            // While there remain elements to shuffle...
            while (0 !== currentIndex) {

                // Pick a remaining element...
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex -= 1;

                // And swap it with the current element.
                temporaryValue = array[currentIndex];
                array[currentIndex] = array[randomIndex];
                array[randomIndex] = temporaryValue;
            }

            return array;
        }

        function getActiveSchool(data){
            let active;
            for(let i=0;i<data.length;i++){
                if(data[i].grade != 0 && data[i].grade != null){
                    active = data[i];
                    break;
                }
                active = data[i]
            }
            return active;
        }
        function isActiveOrganization(data, name, student){
            if(data.length > 0){
                return ', '+name+' merupakan '+student+' yang aktif berorganisasi.'
            }
            return '.'
        }
        function getYear(date){
            let tgl = date.split('-');
            return tgl[0];
        }

        function logout(){
            localStorage.clear();
            window.location.href = "masuk.html";
        }

        function getSelectedJobs(name, data){
            $selected = [];
            if(data.length > 0){
                return name+' menyukai pekerjaan sebagai '+data.map(function(item, idx){
                    if(data.length == 2){
                        if(idx == 0){
                            return item.name+' dan';
                        }else{
                            return ' '+item.name;
                        }
                    }else{
                        if(idx == data.length-2){
                            return item.name+' dan';
                        }else{
                            return ' '+item.name+','
                        }
                    }
                    return item.name;
                });
            }
            return '';
        }

        function getProfile(){
            $.ajax({
                url: 'https://api.vocatinest.com/profiles/'+localStorage.getItem('user_id'),
                contentType: "application/json; charset=utf-8",
                dataType: 'json',
                method: 'GET',
                success: (data) => {
                    console.log(data)
                    shuffle(personas);
                    let student = data.data.sex == 'M' ? 'siswa' : 'siswi';
                    let school = getActiveSchool(data.data.schools);
                    $('#name').html(data.data.name);
                    $('#nav-name').html(data.data.name);
                    $('#image').attr('src', data.data.image);
                    $('#nav-image').attr('src', data.data.image);
                    if(school != undefined){
                        $('#description').html(data.data.name+' merupakan '+student+' '+school.school.name+
                        isActiveOrganization(data.data.organizations, data.data.name, student)+
                        ' '+data.data.name+' merupakan '+student+' yang '+personas[0].toLowerCase()+' dan '+personas[1].toLowerCase()+'. '+
                        'Saat ini '+data.data.name+' merupakan '+student+' kelas '+school.grade+'. '+
                        getSelectedJobs(data.data.name, data.data.selected_jobs))
                        data.data.work_history.map(function(item, idx){
                            $('#job-experience').append('<div class="row mb-2">\
                                <div class="col-2 my-auto">\
                                    <p class="besar"><b>'+getYear(item.start_date)+'</b></p>\
                                </div>\
                                <div class="col-4 my-auto">\
                                    <p>'+item.position+'</p>\
                                </div>\
                                <div class="col-2 my-auto">\
                                    <p>'+item.role+'</p>\
                                </div>\
                                <div class="col-4 my-auto">\
                                    <p>'+item.name+'</p>\
                                </div>\
                            </div>')
                        });
                        data.data.schools.map(function(item, idx){
                            $('#side_education').append('<p class="besar">'+item.school.name+'</p>');
                            $('#education').append('<div class="row mb-2">\
                                <div class="col-4 my-auto">\
                                    <p>'+item.school.name+'</p>\
                                </div>\
                                <div class="col-2 my-auto">\
                                    <p>'+item.major.major+'</p>\
                                </div>\
                                <div class="col-3 my-auto my-auto">\
                                    <a href="">\
                                        <p class="sertif"><img src="img/download-icon.svg" alt="">Ijazah/Sertifikat</p>\
                                    </a>\
                                </div>\
                                <div class="col-3 my-auto">\
                                    <p>'+getYear(item.start_date)+' - '+getYear(item.end_date)+'</p>\
                                </div>\
                            </div>');
                        })
                        data.data.selected_jobs.map(function(item, idx){
                            $('#related-jobs').append('<li class="nav-item">\
                                    <a class="nav-link" href="#">'+item.name+'</a>\
                                </li>')
                        });
                    }else{
                        $('#description').html(data.data.name+' merupakan '+student+'.'+
                        isActiveOrganization(data.data.organizations, data.data.name, student)+
                        ' '+data.data.name+' merupakan '+student+' yang '+personas[0].toLowerCase()+' dan '+personas[1].toLowerCase()+'. '+
                        getSelectedJobs(data.data.name, data.data.selected_jobs))
                        data.data.work_history.map(function(item, idx){
                            $('#job-experience').append('<div class="row mb-2">\
                                <div class="col-2 my-auto">\
                                    <p class="besar"><b>'+getYear(item.start_date)+'</b></p>\
                                </div>\
                                <div class="col-4 my-auto">\
                                    <p>'+item.position+'</p>\
                                </div>\
                                <div class="col-2 my-auto">\
                                    <p>'+item.role+'</p>\
                                </div>\
                                <div class="col-4 my-auto">\
                                    <p>'+item.name+'</p>\
                                </div>\
                            </div>')
                        });
                        data.data.selected_jobs.map(function(item, idx){
                            $('#related-jobs').append('<li class="nav-item">\
                                    <a class="nav-link" href="#">'+item.name+'</a>\
                                </li>')
                        })
                    }
                },
                error: (error) => {
                    console.log(error)
                    if(error.status == 400){
                        window.location.href = 'edit-profile1.html';
                    }
                }
            });
        }
        $(function(){
            getProfile();
        })
    </script>
</body>

</html>
